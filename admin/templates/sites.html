{% extends "base.html" %}

{% block title %}Sites{% endblock %}
{% block main %}
<h2>Sites</h2>
Update all : <a href="/admin/forecast/update?redirect">forecasts</a> |
<a href="/admin/observation/update?redirect">observations</a> |
<a href="/admin/sites/refresh">sites</a>
<table class="sites">
    <thead>
    <tr>
        <th>id</th>
        <th>name</th>
        <th>location</th>
        <th>update</th>
    </tr>
    </thead>
    <tbody>
    {% for  site in sites %}
    <tr>
        <td>{{site.key().id_or_name()}}</td>
        <td>{{site.name}}</td>
        <td>{{site.location}}</td>
        <td>
            <a href="#forecast" data-id="{{site.key().id_or_name()}}" class="forecast">forecast</a> |
            <a href="#observations" data-id="{{site.key().id_or_name()}}" class="observation">observations</a>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>
{% endblock %}
{% block footer %}-----{% endblock %}

{% block last %}
<script type="text/javascript">
    $(function(){
        $('table.sites a.forecast').click(function(e){
            var id = $(this).attr("data-id");
            $.ajax({
                url:"/admin/sites/" + id + "/forecast/update",
                type:'POST',
                success:function(){
                    alert("Done");
                }
            });
            e.preventDefault();
        });
        $('table.sites a.observation').click(function(e){
            var id = $(this).attr("data-id");
            $.ajax({
                url:"/admin/sites/" + id + "/observation/update",
                type:'POST',
                success:function(){
                    alert("Done");
                }
            });
            e.preventDefault();
        });
    })
</script>
{% endblock %}
